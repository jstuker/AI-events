{{ define "title" }}{{ .Site.Title }} — The definitive source of AI events in Switzerland{{ end }}

{{ define "main" }}
{{ partial "event-card-styles.html" . }}

{{ $events := where (where .Site.RegularPages "Section" "events") "Params.status" "published" }}
{{ $now := now }}
{{ $today := time (printf "%d-%02d-%02d" $now.Year $now.Month $now.Day) }}
{{ $currentYear := $now.Year }}

{{/* Filter to current year only */}}
{{ $yearEvents := slice }}
{{ range $events }}
  {{ if eq (.Date.Year) $currentYear }}
    {{ $yearEvents = $yearEvents | append . }}
  {{ end }}
{{ end }}

{{/* Split into upcoming (today+) and past (before today) */}}
{{ $upcoming := slice }}
{{ $past := slice }}
{{ range $yearEvents }}
  {{ $eventDate := time (dateFormat "2006-01-02" .Params.event_start_date) }}
  {{ if ge $eventDate $today }}
    {{ $upcoming = $upcoming | append . }}
  {{ else }}
    {{ $past = $past | append . }}
  {{ end }}
{{ end }}

{{/* Sort upcoming by date ascending, past by date descending */}}
{{ $upcoming = sort $upcoming "Params.event_start_date" "asc" }}
{{ $past = sort $past "Params.event_start_date" "desc" }}

{{ $featuredUpcoming := where $upcoming "Params.featured" true }}
{{ $regularUpcoming := where $upcoming "Params.featured" "ne" true }}

{{/* ── Upcoming Events ── */}}
<h2 class="section-heading">Upcoming Events</h2>

{{ partial "event-listing-controls.html" . }}

<ul class="events-list" id="events-list">
  {{- range $featuredUpcoming }}
  {{ partial "event-card.html" . }}
  {{- end }}
  {{- range $regularUpcoming }}
  {{ partial "event-card.html" . }}
  {{- end }}
</ul>

<table class="upcoming-list-view past-events-table" id="upcoming-list-view" style="display:none;">
  <thead>
    <tr>
      <th>Date</th>
      <th>Event</th>
      <th>City</th>
    </tr>
  </thead>
  <tbody id="upcoming-list-body"></tbody>
</table>

<div style="text-align:center; margin-top:1.5rem;">
  <button id="load-more" class="btn-load-more" onclick="loadMore()" style="display:none;">Load more</button>
</div>

<div id="no-results" class="no-results" style="display:none;">
  <p>No upcoming events match your filters.</p>
  <p><button onclick="resetFilters()">Clear all filters</button></p>
</div>

{{ partial "event-listing-scripts.html" . }}

{{/* ── Past Events ── */}}
{{ if $past }}
<h2 class="section-heading" style="margin-top:3rem;">Past Events</h2>

<table class="past-events-table">
  <thead>
    <tr>
      <th>Date</th>
      <th>Event</th>
      <th>City</th>
    </tr>
  </thead>
  <tbody>
    {{ range $past }}
    <tr>
      <td class="date-col"><time datetime="{{ dateFormat "2006-01-02" .Params.event_start_date }}">{{ dateFormat "2 Jan 2006" .Params.event_start_date }}</time></td>
      <td><a href="{{ .RelPermalink }}">{{ .Params.event_name }}</a></td>
      <td class="city-col">{{ with .Params.cities }}{{ index . 0 }}{{ end }}</td>
    </tr>
    {{ end }}
  </tbody>
</table>
{{ end }}

{{ end }}
