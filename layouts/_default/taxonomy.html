{{ define "title" }}{{ .Title }} — {{ .Site.Title }}{{ end }}

{{ define "main" }}
<a href="{{ "/" | relURL }}" class="back-link">&larr; All Events</a>
<h1>{{ .Title }}</h1>
{{ with .Content }}<div class="section-description">{{ . }}</div>{{ end }}

{{ if eq .Kind "term" }}
{{/* Term page: list events belonging to this term */}}
<style>
  .events-list { list-style: none; display: grid; gap: 1.5rem; margin-top: 1.5rem; }
  .event-card {
    border: 1px solid var(--color-border);
    border-radius: 8px;
    padding: 1.25rem;
    transition: box-shadow 0.2s;
  }
  .event-card:hover { box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
  .event-card.featured { border-left: 4px solid var(--color-featured); }
  .event-card h2 { font-size: 1.25rem; margin-bottom: 0.5rem; }
  .event-card h2 a { color: var(--color-text); text-decoration: none; }
  .event-card h2 a:hover { color: var(--color-primary); }
  .event-meta { color: var(--color-muted); font-size: 0.875rem; display: flex; flex-wrap: wrap; gap: 1rem; }
  .badge { display: inline-block; background: var(--color-featured); color: #fff; font-size: 0.75rem; padding: 0.15rem 0.5rem; border-radius: 4px; font-weight: 600; }
  .tag { display: inline-block; background: #f3f4f6; color: var(--color-muted); font-size: 0.75rem; padding: 0.15rem 0.5rem; border-radius: 4px; margin-right: 0.25rem; }
</style>

{{ $published := where .Pages "Params.status" "published" }}
{{ if $published }}
<ul class="events-list">
  {{- range $published }}
  <li class="event-card{{ if .Params.featured }} featured{{ end }}">
    {{ if and .Params.featured (eq .Params.featured_type "badge") }}<span class="badge">Featured</span>{{ end }}
    <h2><a href="{{ .RelPermalink }}">{{ .Params.event_name }}</a></h2>
    <div class="event-meta">
      <span>{{ dateFormat "2 Jan 2006, 15:04" .Params.event_start_date }}</span>
      <span>{{ .Params.location_name }}</span>
      {{ with .Params.event_attendance_mode }}<span>{{ . }}</span>{{ end }}
      {{ if eq .Params.event_price_type "free" }}<span>Free</span>
      {{ else if eq .Params.event_price_type "paid" }}<span>{{ .Params.event_price_currency }} {{ .Params.event_price }}</span>
      {{ else if eq .Params.event_price_type "range" }}<span>{{ .Params.event_price_currency }} {{ .Params.event_low_price }}–{{ .Params.event_high_price }}</span>
      {{ end }}
    </div>
    <p style="margin-top: 0.5rem;">{{ .Params.event_description | truncate 200 }}</p>
    {{ with .Params.tags }}<div style="margin-top: 0.5rem;">{{ range . }}<span class="tag">{{ . }}</span>{{ end }}</div>{{ end }}
  </li>
  {{- end }}
</ul>
{{ else }}
<p style="margin-top: 1.5rem; color: var(--color-muted);">No published events found.</p>
{{ end }}

{{ else }}
{{/* Taxonomy overview page: list all terms with event counts */}}
<style>
  .taxonomy-list { list-style: none; display: grid; gap: 0.75rem; margin-top: 1.5rem; }
  .taxonomy-item {
    border: 1px solid var(--color-border);
    border-radius: 8px;
    padding: 0.75rem 1.25rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
    transition: box-shadow 0.2s;
  }
  .taxonomy-item:hover { box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
  .taxonomy-item a { color: var(--color-text); text-decoration: none; font-weight: 500; }
  .taxonomy-item a:hover { color: var(--color-primary); }
  .taxonomy-count {
    background: #f3f4f6;
    color: var(--color-muted);
    font-size: 0.875rem;
    padding: 0.15rem 0.6rem;
    border-radius: 12px;
    font-weight: 600;
  }
</style>

<ul class="taxonomy-list">
  {{- range .Pages }}
  {{ $count := len (where .Pages "Params.status" "published") }}
  {{ if gt $count 0 }}
  <li class="taxonomy-item">
    <a href="{{ .RelPermalink }}">{{ .Title }}</a>
    <span class="taxonomy-count">{{ $count }}</span>
  </li>
  {{ end }}
  {{- end }}
</ul>
{{ end }}
{{ end }}
